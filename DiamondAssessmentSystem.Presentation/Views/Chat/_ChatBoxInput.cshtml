@model int  

<form asp-action="SendMessage" asp-controller="ChatMessages" method="post" enctype="multipart/form-data" id="chatbox-form">
    <input type="hidden" name="conversationId" value="@Model" />

    <div class="chatbox-input-wrapper">
        <textarea name="Message" id="chatbox-message" class="chatbox-textarea" placeholder="Nhập tin nhắn..." rows="1" maxlength="500"></textarea>

        <div class="chatbox-button-row-wrapper">
            <div class="chatbox-button-row">
                <button type="button" class="chatbox-btn chatbox-emoji-btn" id="emoji-btn">😊</button>

                <button type="submit" class="chatbox-btn chatbox-send-btn">Gửi</button>

                <label class="chatbox-btn chatbox-file-btn">
                    Gửi file
                    <input type="file" name="file" onchange="handleFileUpload(@Model, this)" />
                </label>
            </div>

            <div id="emoji-picker-container" class="emoji-picker-container" style="display: none;"></div>
        </div>
    </div>
</form>

@section Scripts {
<script>
    const trigger = document.getElementById('emoji-btn');
    const input = document.getElementById('chatbox-message');
    const pickerContainer = document.getElementById('emoji-picker-container');

    const picker = new EmojiButton({
        rootElement: pickerContainer,
        position: 'top-end',
        theme: 'light'
    });

    picker.on('emoji', emoji => {
        input.value += emoji;
    });

    trigger.addEventListener('click', () => {
        picker.togglePicker(trigger);
    });

    function handleFileUpload(conversationId, inputFile) {
        const form = document.getElementById('chatbox-form');
        form.action = `/ChatMessages/UploadFile?conversationId=${conversationId}`;
        form.submit();
    }
</script>
}
